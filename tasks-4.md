# Deployment Tasks

## PR #18: Frontend Deployment (Netlify)

### Prerequisites
- [ ] 18.1: Verify all frontend features are working locally
- [ ] 18.2: Ensure all environment variables are documented
- [ ] 18.3: Test production build locally (`npm run build && npm run preview`)

### Netlify Configuration
- [ ] 18.4: Create `netlify.toml` in project root with build settings
- [ ] 18.5: Configure build command: `npm run build`
- [ ] 18.6: Configure publish directory: `frontend/dist`
- [ ] 18.7: Configure base directory: `frontend`
- [ ] 18.8: Add redirect rules for React Router (SPA routing)
- [ ] 18.9: Configure Node.js version (should match local development)

### Environment Variables Setup
- [ ] 18.10: Document required environment variable: `VITE_API_URL`
- [ ] 18.11: Create instructions for setting `VITE_API_URL` to Railway backend URL
- [ ] 18.12: Note: Environment variables must be set in Netlify dashboard (Site settings → Environment variables)

### GitHub Integration
- [ ] 18.13: Connect Netlify to GitHub repository
- [ ] 18.14: Configure auto-deploy from `main` branch
- [ ] 18.15: Enable deploy previews for pull requests (optional but recommended)

### Build Optimization
- [ ] 18.16: Verify Vite build optimization settings
- [ ] 18.17: Ensure all assets are properly bundled
- [ ] 18.18: Test that `@` path alias works in production build

### Post-Deployment
- [ ] 18.19: Verify deployed site loads correctly
- [ ] 18.20: Test login flow with backend API
- [ ] 18.21: Test asset upload (S3 integration)
- [ ] 18.22: Test campaign creation and approval workflow
- [ ] 18.23: Verify all routes work (no 404s on refresh)
- [ ] 18.24: Test on mobile device/responsive design
- [ ] 18.25: Check browser console for errors
- [ ] 18.26: Update README with deployment URL and instructions

### Checklist Summary
**Files to Create:**
- `netlify.toml`

**Configuration on Netlify Dashboard:**
- Connect GitHub repository
- Set environment variable: `VITE_API_URL`
- Enable auto-deploy from `main` branch

**Testing:**
- Production build locally
- Deployed site functionality
- Cross-browser compatibility

---

## PR #19: Backend Deployment (Railway)

### Prerequisites
- [ ] 19.1: Verify all backend endpoints are working locally
- [ ] 19.2: Ensure all environment variables are documented
- [ ] 19.3: Test database migrations locally
- [ ] 19.4: Review Python version compatibility (Python 3.11+)

### Railway Configuration
- [ ] 19.5: Create `railway.json` or use Railway's auto-detection (Railway auto-detects Python apps)
- [ ] 19.6: Verify `requirements.txt` is up to date and includes all dependencies
- [ ] 19.7: Ensure uvicorn is specified in requirements.txt (already present)
- [ ] 19.8: Create `Procfile` or start command for Railway: `uvicorn main:app --host 0.0.0.0 --port $PORT`
- [ ] 19.9: Verify Python version in Railway matches local (3.11+)

### Database Setup
- [ ] 19.10: Create PostgreSQL database in Railway
- [ ] 19.11: Railway will auto-generate `DATABASE_URL` environment variable
- [ ] 19.12: Update SQLAlchemy connection string to support PostgreSQL
- [ ] 19.13: Test database connection with PostgreSQL locally (optional)
- [ ] 19.14: Verify Alembic migrations work with PostgreSQL
- [ ] 19.15: Plan for running migrations on Railway (manual trigger or startup script)

### Environment Variables Setup
- [ ] 19.16: Document all required environment variables:
  - `DATABASE_URL` (auto-generated by Railway PostgreSQL plugin)
  - `AWS_ACCESS_KEY_ID`
  - `AWS_SECRET_ACCESS_KEY`
  - `AWS_S3_BUCKET`
  - `AWS_REGION`
  - `OPENAI_API_KEY`
- [ ] 19.17: Create instructions for setting env vars in Railway dashboard
- [ ] 19.18: Note: All env vars set via Railway dashboard (Variables tab)

### CORS Configuration
- [ ] 19.19: Update `main.py` CORS allowed_origins to include Netlify URL
- [ ] 19.20: Consider using environment variable for frontend URL (e.g., `FRONTEND_URL`)
- [ ] 19.21: Ensure CORS allows credentials for authentication

### GitHub Integration
- [ ] 19.22: Connect Railway to GitHub repository
- [ ] 19.23: Configure auto-deploy from `main` branch
- [ ] 19.24: Set root directory to `backend` (if needed)
- [ ] 19.25: Railway will auto-detect Python app and install dependencies

### Database Migration Strategy
- [ ] 19.26: Create migration script or manual process documentation
- [ ] 19.27: Option 1: Run migrations manually via Railway CLI
- [ ] 19.28: Option 2: Add migration command to startup (in Procfile or railway.json)
- [ ] 19.29: Consider adding a "release" command: `alembic upgrade head`
- [ ] 19.30: Document seed data strategy (manual run or automated)

### Production Dependencies
- [ ] 19.31: Verify all dependencies are production-ready
- [ ] 19.32: Check MJML package works in Railway environment (requires Node.js)
- [ ] 19.33: Railway includes Node.js by default, verify mjml installation
- [ ] 19.34: Test OpenAI API connectivity from Railway
- [ ] 19.35: Test S3 connectivity from Railway

### Health Checks
- [ ] 19.36: Verify `/health` endpoint works
- [ ] 19.37: Configure Railway health check endpoint (optional)
- [ ] 19.38: Monitor application logs during deployment

### Post-Deployment
- [ ] 19.39: Verify backend API is accessible at Railway URL
- [ ] 19.40: Test `/health` endpoint
- [ ] 19.41: Test `/docs` (Swagger UI) endpoint
- [ ] 19.42: Test login endpoint with seeded users
- [ ] 19.43: Test S3 upload functionality
- [ ] 19.44: Test OpenAI integration (asset categorization)
- [ ] 19.45: Test email generation (MJML compilation)
- [ ] 19.46: Run full end-to-end test from frontend to backend
- [ ] 19.47: Monitor Railway logs for errors
- [ ] 19.48: Monitor Railway metrics (CPU, memory, requests)
- [ ] 19.49: Update README with backend API URL and deployment instructions
- [ ] 19.50: Update frontend environment variable (`VITE_API_URL`) with Railway URL

### Database Seeding (Production)
- [ ] 19.51: Decide on seed data strategy for production
- [ ] 19.52: Option 1: Run seed script manually via Railway CLI
- [ ] 19.53: Option 2: Create admin panel for user management
- [ ] 19.54: Document seed process in README

### Checklist Summary
**Files to Create/Modify:**
- `Procfile` or start command
- Update `main.py` CORS configuration
- Optionally: `railway.json` for custom config
- Optionally: startup script for migrations

**Configuration on Railway Dashboard:**
- Connect GitHub repository
- Add PostgreSQL database plugin
- Set environment variables (AWS, OpenAI)
- Configure auto-deploy from `main` branch

**Database:**
- Run Alembic migrations
- Seed production users (manual or script)

**Testing:**
- All API endpoints
- Database connectivity
- S3 integration
- OpenAI integration
- MJML compilation
- End-to-end workflow

---

## Integration Tasks (Post-Deployment)

### Frontend-Backend Integration
- [ ] 20.1: Update frontend `VITE_API_URL` to point to Railway backend
- [ ] 20.2: Update backend CORS to allow Netlify frontend
- [ ] 20.3: Test full authentication flow (login, protected routes)
- [ ] 20.4: Test asset upload flow (frontend → backend → S3)
- [ ] 20.5: Test campaign creation flow (frontend → backend → database)
- [ ] 20.6: Test email generation flow (frontend → backend → OpenAI → MJML)
- [ ] 20.7: Test approval workflow (frontend → backend → database)
- [ ] 20.8: Test monitoring dashboard (frontend → backend → metrics)

### Production Configuration
- [ ] 20.9: Verify HTTPS is enabled on both Netlify and Railway
- [ ] 20.10: Update any hardcoded URLs in codebase
- [ ] 20.11: Verify S3 bucket permissions for production
- [ ] 20.12: Check OpenAI API rate limits and usage
- [ ] 20.13: Set up error monitoring (optional: Sentry, LogRocket)
- [ ] 20.14: Set up uptime monitoring (optional: UptimeRobot, Pingdom)

### Documentation
- [ ] 20.15: Update README with both deployment URLs
- [ ] 20.16: Document deployment process for future updates
- [ ] 20.17: Document rollback procedure
- [ ] 20.18: Document environment variable setup
- [ ] 20.19: Create troubleshooting guide for common deployment issues
- [ ] 20.20: Update Memory Bank with deployment context

---

## Notes

### Netlify Deployment (Simple & Fast)
- Netlify auto-detects Vite/React apps
- `netlify.toml` provides explicit configuration
- GitHub integration enables automatic deployments
- Free tier includes: 100GB bandwidth, 300 build minutes/month
- Deploy previews for PRs are helpful for testing

### Railway Deployment (Simple & Powerful)
- Railway auto-detects Python apps via `requirements.txt`
- No Docker required (Railway handles containerization)
- PostgreSQL plugin auto-configures database
- Free tier includes: $5/month credit, shared CPU, 512MB RAM
- CLI available for manual operations: `railway run alembic upgrade head`
- Environment variables set via dashboard (secure)

### Key Considerations
1. **Database Migration**: SQLite → PostgreSQL requires schema recreation (Alembic migrations)
2. **Environment Variables**: Must be set on both platforms before first deployment
3. **CORS**: Backend must explicitly allow Netlify frontend URL
4. **Node.js**: Railway includes Node.js for MJML package
5. **Secrets**: Never commit `.env` files; use platform dashboards
6. **Testing**: Test locally with production build before deploying

### Deployment Order
1. Deploy backend to Railway first (get API URL)
2. Set `VITE_API_URL` in Netlify to Railway URL
3. Deploy frontend to Netlify
4. Test end-to-end integration
5. Update documentation with URLs

### Estimated Time
- **PR #18** (Netlify): 1-2 hours (mostly configuration and testing)
- **PR #19** (Railway): 2-3 hours (database migration, testing, monitoring)
- **Total**: 3-5 hours for both PRs

### Success Criteria
- ✅ Frontend loads on Netlify URL
- ✅ Backend API responds on Railway URL
- ✅ Login flow works end-to-end
- ✅ Asset upload works (S3 integration)
- ✅ Campaign creation works
- ✅ Email generation works (OpenAI + MJML)
- ✅ Approval workflow works
- ✅ Monitoring dashboard works
- ✅ No console errors
- ✅ HTTPS enabled on both platforms

