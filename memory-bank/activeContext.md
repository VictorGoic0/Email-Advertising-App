# Active Context

## Current Status

**Phase**: Deployment  
**Date**: PR #18 Complete, PR #19 Mostly Complete (DB Migration Issue)  
**Focus**: Running database migrations on Railway - commands not working, needs investigation

## Recent Changes

- âœ… **PR #18 Complete**: Frontend deployment to Netlify
  - Created `netlify.toml` with build configuration
  - Configured SPA routing redirects
  - Updated README with Netlify deployment instructions
  - Frontend deployed at: `https://email-advertising-generator.netlify.app`
  - Auto-deploy from `main` branch configured
  - All environment variables set
  - All tasks complete (18.1-18.26)

- ðŸš§ **PR #19 In Progress**: Backend deployment to Railway
  - Created `backend/Procfile` for Railway start command
  - Updated CORS to include Netlify URL
  - Added `FRONTEND_URL` environment variable support
  - Added PostgreSQL driver (`psycopg2-binary`) to requirements.txt
  - Created production S3 bucket setup script
  - Documented production S3 bucket: `email-assets-prod-goico`
  - Updated README with Railway deployment instructions
  - âœ… Railway repository connected (user completed)
  - âœ… Auto-deploy from `main` branch configured (user completed)
  - âœ… Root directory set to `backend` (user completed)
  - âœ… Production S3 bucket created: `email-assets-prod-goico` (user completed)
  - âœ… All environment variables set in Railway (user completed):
    - `DATABASE_URL` (auto-generated by Railway PostgreSQL plugin)
    - `AWS_ACCESS_KEY_ID`
    - `AWS_SECRET_ACCESS_KEY`
    - `AWS_S3_BUCKET` = `email-assets-prod-goico`
    - `AWS_REGION` = `us-east-2`
    - `OPENAI_API_KEY`
    - `FRONTEND_URL` (optional)
  - âš ï¸ **ISSUE**: Database migration commands not working:
    - `railway run alembic upgrade head` - not working
    - `railway run python ../scripts/seed_database.py` - not working
    - Root cause: Railway root directory is `backend`, may need different command format or path resolution

- âœ… **PR #17 Complete**: UI polish & final touches
  - Created `LoadingSpinner` component (`/frontend/src/components/LoadingSpinner.jsx`)
  - Created `Skeleton` component (`/frontend/src/components/Skeleton.jsx`) with SkeletonCard and SkeletonMetricCard variants
  - Added skeleton loaders to main dashboard pages (AdvertiserDashboard, ApprovalQueuePage, PerformanceDashboard)
  - Created `ErrorMessage` component (`/frontend/src/components/ErrorMessage.jsx`) with retry functionality
  - Replaced error displays in CampaignList, ApprovalQueue, and other components with ErrorMessage
  - Created `EmptyState` component (`/frontend/src/components/EmptyState.jsx`)
  - Improved empty states for assets, campaigns, and approval queue with helpful text and action buttons
  - Added responsive hamburger menu for mobile navigation in Layout component
  - Added accessibility improvements:
    - Aria labels to interactive elements
    - Keyboard navigation (Enter/Space) for clickable cards
    - Focus styles with ring indicators
    - `aria-current` for active navigation links
  - Verified all grid layouts use responsive classes
  - All tasks complete (17.1-17.32), MVP ready

- âœ… **PR #16 Complete**: Role-based dashboard & navigation
  - Created `AdvertiserDashboard` component (`/frontend/src/components/AdvertiserDashboard.jsx`)
    - Displays quick stats (total campaigns, approved, pending) calculated from campaigns list
    - Shows recent campaigns list (last 5, sorted by created_at)
    - "Create New Campaign" CTA button
    - Styled with Tailwind CSS
    - Loading and empty states
  - Updated `Dashboard` component (`/frontend/src/pages/Dashboard.jsx`)
    - Role-based rendering: AdvertiserDashboard for advertisers, ApprovalQueue for campaign managers, PerformanceDashboard for tech support
    - Later updated: Dashboard now only accessible to advertisers, non-advertisers redirected to their main pages
  - Updated `Layout` component (`/frontend/src/components/Layout.jsx`)
    - Added role-based navigation links in header
    - Advertiser links: Dashboard, My Campaigns, Upload Assets
    - Campaign Manager links: Approval Queue
    - Tech Support links: Monitoring Dashboard
    - Active route highlighting
    - Logo link routes to role-appropriate main page
    - Responsive navigation (hidden on mobile, shown on md+)
  - Updated `App.jsx` routing
    - All routes properly configured: `/`, `/dashboard`, `/campaigns`, `/campaigns/new`, `/campaigns/:id`, `/approval-queue`, `/approval-queue/:id`, `/monitoring`
    - Dashboard route protected with `RequireRole` (advertisers only)
    - Role-specific routes wrapped with `RequireRole` HOC
  - Created `RequireRole` component (`/frontend/src/components/RequireRole.jsx`)
    - HOC for role-based route protection
    - Accepts `allowedRoles` prop
    - Redirects to role-appropriate main page if role not allowed (campaign_manager â†’ /approval-queue, tech_support â†’ /monitoring, others â†’ /dashboard)
    - Handles loading state
  - Key design decisions:
    - Dashboard only accessible to advertisers (non-advertisers redirected to their main pages)
    - "Create Campaign" removed from navigation (button still exists in AdvertiserDashboard)
    - "Upload Assets" added to advertiser navigation
    - Stats calculated from existing campaigns list (no new API endpoint)
  - All tasks complete (16.1-16.35)

- âœ… **PR #15 Complete**: Performance monitoring UI (Tech Support)
  - Created `useMetrics` hook (`/frontend/src/hooks/useMetrics.js`)
    - `fetchUptimeMetrics()` - Fetches all 4 components (api, s3, database, openai) in parallel
    - `fetchProofGenerationMetrics()` - Fetches proof generation performance stats
    - `fetchQueueDepth()` - Fetches current approval queue depth
    - `fetchApprovalRate(days)` - Fetches approval rate metrics (default 7 days)
    - `fetchAllMetrics()` - Fetches all metrics at once
    - Loading and error states for each metric type
  - Created `MetricCard` component (`/frontend/src/components/MetricCard.jsx`)
    - Accepts title, value, subtitle, status props
    - Color coding with status thresholds:
      - Uptime: green >99%, yellow 95-99%, red <95%
      - Proof Generation: green <5s, yellow 5-20s, red >25s
      - Queue Depth: no color (agnostic)
      - Approval Rate: green >=80%, yellow 50-80%, red <=50%
    - Helper functions for status determination
    - Styled with shadcn Card component
  - Created `PerformanceDashboard` component (`/frontend/src/components/PerformanceDashboard.jsx`)
    - Fetches all metrics on mount
    - Displays 4 uptime cards (one per component: api, s3, database, openai)
    - Displays proof generation, queue depth, and approval rate cards
    - Responsive grid layout (md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4)
    - Auto-refresh every 30 seconds
    - Manual refresh button with loading state
    - Approval rate dropdown (7-day/30-day selector)
    - Error message display for each metric type
  - Created `MonitoringPage` (`/frontend/src/pages/MonitoringPage.jsx`)
    - Page header with description
    - Role-based access (redirects non-tech_support users)
    - Integrates PerformanceDashboard
    - Handles loading and error states
  - Added route in `App.jsx`: `/monitoring` - Monitoring dashboard page
  - Updated `Dashboard.jsx`: Added "View Monitoring Dashboard" button for tech_support users
  - All tasks complete (15.1-15.37), chart implementation skipped (no backend route for historical data)

- âœ… **PR #14 Complete**: Approval queue UI (Campaign Manager)
  - Created `ApprovalQueue` component (`/frontend/src/components/ApprovalQueue.jsx`)
    - Fetches approval queue from `/api/campaigns/approval-queue` endpoint
    - Displays pending campaigns in responsive grid layout
    - Shows campaign name, advertiser ID (truncated), timestamp
    - Thumbnail preview extraction from email HTML (first image or placeholder)
    - Sorted by created_at (oldest first)
    - Click handler to navigate to campaign review
    - Empty state with helpful message
    - Loading and error states
  - Created `CampaignReview` component (`/frontend/src/components/CampaignReview.jsx`)
    - Fetches campaign details with email proof
    - Displays campaign information (advertiser ID, created date, target audience, goal, notes)
    - Integrates EmailPreview component for email rendering
    - Approve button (primary, right side) with loading state
    - Reject button (outline, left side) that opens rejection modal
    - Success/error message handling
    - Navigates back to approval queue after successful action
  - Created `RejectionModal` component (`/frontend/src/components/RejectionModal.jsx`)
    - Modal overlay with backdrop
    - Textarea for rejection reason (required)
    - Form validation (rejection reason cannot be empty)
    - Cancel and Submit buttons
    - Styled with shadcn Card component
    - Loading state during submission
  - Created `ApprovalQueuePage` (`/frontend/src/pages/ApprovalQueuePage.jsx`)
    - Page header with title and description
    - Queue count display
    - Refresh button to reload queue
    - Integrates ApprovalQueue component
    - Success message display from navigation state (green for approve, red for reject)
    - Auto-refreshes queue when success message received
    - Auto-hides success message after 5 seconds
  - Created `CampaignReviewPage` (`/frontend/src/pages/CampaignReviewPage.jsx`)
    - Gets campaign ID from route params
    - Integrates CampaignReview component
    - Back button to approval queue
  - Updated `useCampaigns` hook (`/frontend/src/hooks/useCampaigns.js`)
    - Added `fetchApprovalQueue()` function
    - Added `approveCampaign()` function (removes campaign from list, no fetch after)
    - Added `rejectCampaign()` function (removes campaign from list, no fetch after)
    - Fixed 403 error by not fetching campaign after approval/rejection
  - Added routes in `App.jsx`:
    - `/approval-queue` - Approval queue page
    - `/approval-queue/:id` - Campaign review page
  - Updated `Dashboard.jsx`:
    - Added "View Approval Queue" button for campaign managers
  - Backend route fix:
    - Moved `/approval-queue` route before `/{campaign_id}` route to prevent 404 errors
    - Route returns empty list (not error) when no campaigns pending
  - All tasks complete (14.1-14.37), tested and working

- âœ… **PR #13 Complete**: Email preview & generation UI
  - Added `generateProof` function to `useCampaigns` hook (`/frontend/src/hooks/useCampaigns.js`)
    - Calls `/campaigns/{campaign_id}/generate-proof` endpoint
    - Handles loading state with `generatingProof` and errors with `proofError`
    - Returns MJML, HTML, and generation time
    - Updates campaign state with generated content
  - Added `submitCampaign` function to `useCampaigns` hook
    - Calls `/campaigns/{campaign_id}/submit` endpoint
    - Updates campaign status to "pending_approval"
    - Handles errors and updates campaign state
  - Created `EmailPreview` component (`/frontend/src/components/EmailPreview.jsx`)
    - Accepts `emailHtml` prop
    - Renders email in iframe using `srcDoc` attribute
    - Applies `sandbox="allow-same-origin"` for security
    - Device view toggle (desktop/mobile) with toolbar
    - Responsive styling for both desktop and mobile views
    - Browser-style header for visual context
  - Updated `EmailPreviewPage` (`/frontend/src/pages/EmailPreviewPage.jsx`)
    - Fetches campaign details by ID
    - "Generate Email Proof" button with loading state
    - Loading spinner during generation
    - Displays generation time after completion
    - Integrated EmailPreview component
    - "Regenerate" button
    - "Submit for Approval" button with API call
    - "Save as Draft" button
    - Success handling and redirect to My Campaigns
    - Error handling for all operations
    - Status-based button enabling/disabling
  - Preview toolbar integrated into EmailPreview component
    - Desktop/mobile toggle buttons with icons (Monitor, Smartphone from lucide-react)
    - Styled with Tailwind CSS
  - All tasks complete (13.1-13.35), ready for testing

- âœ… **PR #12 Complete**: Campaign creation UI
  - Created `CampaignForm` component (`/frontend/src/components/CampaignForm.jsx`)
    - Form with zod validation for campaign name (required), target audience, campaign goal, additional notes
    - Uses shadcn components (Card, Input, Textarea, Label, Button)
    - Loading states and error handling
  - Created `useCampaigns` hook (`/frontend/src/hooks/useCampaigns.js`)
    - Full CRUD operations: createCampaign, fetchCampaigns, fetchCampaign, updateCampaign, deleteCampaign
    - Loading and error state management
  - Created `CreateCampaign` page (`/frontend/src/pages/CreateCampaign.jsx`)
    - Two-step workflow: Select Assets â†’ Campaign Details
    - Step navigation with progress indicator
    - Asset selection with controlled state (no upload functionality - only selection)
    - Form submission with asset IDs
    - Redirects to email preview on success
  - Created `CampaignList` component (`/frontend/src/components/CampaignList.jsx`)
    - Displays campaigns in responsive card grid
    - Status badges (draft, pending_approval, approved, rejected) with color coding
    - Click to view campaign details
    - Loading and error states
    - Empty state handling
  - Created `MyCampaigns` page (`/frontend/src/pages/MyCampaigns.jsx`)
    - Status filtering tabs (All, Draft, Pending Approval, Approved, Rejected)
    - "Create New Campaign" button
    - Integrates CampaignList component
  - Created `Textarea` component (`/frontend/src/components/ui/textarea.jsx`)
    - shadcn-style textarea component
  - Updated `AssetReview` component to support controlled selection mode
  - Updated `AssetUploadPage` to add "Create Campaign" button in organize step
  - Updated `Layout` component: logo/title now clickable and links to dashboard
  - Updated `Dashboard` component: removed redundant logout button, added campaign navigation links
  - Added routes: `/campaigns`, `/campaigns/new`, `/campaigns/:id` (email preview placeholder)
  - Created placeholder `EmailPreviewPage` for PR #13
  - All tasks complete (12.1-12.38), tested and working
  - S3 CORS configuration: Created `s3-cors.json` config file and deployment scripts

- âœ… **PR #11 Complete**: Asset upload UI
  - Created `useAssets` hook (`/frontend/src/hooks/useAssets.js`) with full CRUD operations
    - `fetchAssets()` - Get all user assets
    - `uploadAsset()` - Upload file with progress callback
    - `deleteAsset()` - Delete asset from S3 and database
    - `recategorizeAssets()` - AI-powered recategorization
    - `updateAssetCategory()` - Manual category update
    - Loading and error state management
  - Created `AssetUpload` component (`/frontend/src/components/AssetUpload.jsx`)
    - Drag-and-drop file upload zone
    - File input fallback
    - Upload progress indicator
    - Error and success message display
    - Hover states and visual feedback
  - Created `AssetCard` component (`/frontend/src/components/AssetCard.jsx`)
    - Displays asset filename, category tag, file size
    - Image preview for image assets
    - Icon previews for text/URL assets
    - Delete button with loading state
    - Draggable support for category organization
  - Created `AssetReview` component (`/frontend/src/components/AssetReview.jsx`)
    - Groups assets by category (logo, image, copy, url, pending)
    - Multi-select with custom checkbox component
    - "Recategorize with AI" button for selected assets
    - Grid layout for asset display
    - Loading and empty states
  - Created `CategoryZone` component (`/frontend/src/components/CategoryZone.jsx`)
    - Drop zones for each category
    - Drag-and-drop between categories
    - Visual feedback during drag operations
    - Lists assets by category
    - Updates asset category via API on drop
  - Created `AssetUploadPage` component (`/frontend/src/pages/AssetUploadPage.jsx`)
    - Three-step workflow: Upload â†’ Review â†’ Organize
    - Progress indicator with step navigation
    - Integrates all asset components
    - Error handling and state management
  - Created custom `Checkbox` component (`/frontend/src/components/ui/checkbox.jsx`)
    - Radix UI-based checkbox with theme styling
    - Proper focus states and accessibility
  - Updated routing: Added `/assets` route in `App.jsx`
  - Updated Dashboard: Added link to asset upload page
  - All tasks complete (11.1-11.52), tested and working

- âœ… **PR #10 Complete**: Frontend setup & authentication
  - Created Vite + React project (JavaScript, no TypeScript compilation)
  - Configured Tailwind CSS v3.4.17 with shadcn/ui stone theme
  - Installed shadcn components: button, card, input, form, label, dropdown-menu, checkbox
  - Created folder structure: components, pages, lib, hooks, contexts, types
  - Created IDE-only TypeScript types (`src/types/index.d.ts`) for autocomplete without build dependency
  - Set up Axios client with baseURL auto-appending `/api` and request/response interceptors
  - Created AuthContext with login/logout functionality and localStorage persistence
  - Built Login page with shadcn components, React Hook Form, Zod validation, and modern styling
  - Implemented ProtectedRoute component with loading state and redirect logic
  - Set up React Router with BrowserRouter, AuthProvider wrapper, and protected routes
  - Created Layout component with header, user dropdown menu, and responsive design
  - All tasks complete (10.1-10.61), tested and working

- âœ… **PR #8 Complete**: Performance monitoring dashboard (backend)
  - Created `/backend/services/health_service.py` with health check functions:
    - `check_api_health()` - Checks API health via database connectivity
    - `check_s3_health()` - Checks S3 service by listing bucket contents
    - `check_database_health()` - Checks database with simple query
    - `check_openai_health()` - Checks OpenAI API connectivity
    - `perform_all_health_checks()` - Runs all checks and records results
  - Created `/backend/routers/metrics.py` with metrics endpoints:
    - `GET /api/metrics/uptime` - Returns uptime metrics for components (api, s3, database, openai) over last 24 hours
    - `GET /api/metrics/proof-generation` - Returns proof generation performance metrics (average, P50, P95, P99)
    - `GET /api/metrics/queue-depth` - Returns current approval queue depth
    - `GET /api/metrics/approval-rate` - Returns approval rate metrics with breakdown (accepts days parameter)
    - All endpoints require `tech_support` role
  - Created `/backend/schemas/metrics.py` with response schemas:
    - `UptimeMetricsResponse`, `ProofGenerationMetricsResponse`, `QueueDepthMetricsResponse`, `ApprovalRateMetricsResponse`
  - Created `/scripts/health_check_worker.py` for background health checks:
    - Runs health checks every 5 minutes
    - Records results in `system_health` table
    - Includes error handling and logging
  - Registered metrics router in `main.py`
  - All implementation tasks complete (8.1-8.32), testing deferred until PR #9

- âœ… **PR #7 Complete**: Approval workflow (backend)
  - Added `POST /api/campaigns/{campaign_id}/submit` endpoint
    - Verifies user is advertiser
    - Verifies campaign belongs to current user
    - Verifies campaign has generated email (both HTML and MJML)
    - Updates campaign status to "pending_approval"
    - Updates `updated_at` timestamp
  - Added `GET /api/campaigns/approval-queue` endpoint
    - Verifies user is campaign_manager
    - Queries campaigns with status "pending_approval"
    - Sorts by created_at (oldest first)
  - Added `POST /api/campaigns/{campaign_id}/approve` endpoint
    - Verifies user is campaign_manager
    - Updates status to "approved"
    - Sets reviewed_by and reviewed_at
    - Records approval metric
  - Added `POST /api/campaigns/{campaign_id}/reject` endpoint
    - Verifies user is campaign_manager
    - Accepts rejection_reason in request body (RejectionRequest schema)
    - Validates rejection_reason is not empty
    - Updates status to "rejected"
    - Sets reviewed_by, reviewed_at, and rejection_reason
    - Records rejection metric
  - Added metrics helper functions in `crud/metrics.py`:
    - `get_queue_depth()` - Calculate current approval queue depth
    - `calculate_approval_rate()` - Calculate approval rate over time period
    - `calculate_time_to_approval()` - Calculate average time to approval
  - Created `RejectionRequest` and `SuccessMessage` schemas
  - All implementation tasks complete (7.1-7.34), testing deferred until PR #9

- âœ… **PR #6 Complete**: Email proof generation with AI (backend)
  - Created `/backend/services/mjml_service.py` with `compile_mjml_to_html` function
    - Uses Python mjml package API when available, falls back to CLI
    - Error handling for invalid MJML and missing dependencies
  - Created `/backend/crud/metrics.py` with `record_metric` function
    - Records performance metrics with type, value, and optional metadata
    - Exported in `crud/__init__.py`
  - Added `POST /api/campaigns/{campaign_id}/generate-proof` endpoint to campaign router
    - Fetches campaign with linked assets from database
    - Verifies campaign belongs to current user
    - Calls OpenAI service to generate MJML (GPT-4, temperature 0.7)
    - Compiles MJML to HTML using MJML service
    - Updates campaign with `generated_email_mjml` and `generated_email_html`
    - Records performance metric with generation time and metadata
    - Returns `ProofGenerationResponse` with MJML, HTML, and generation_time
    - Comprehensive error handling for OpenAI failures, MJML compilation errors, and permission issues
  - Added `ProofGenerationResponse` schema to campaign schemas
  - All implementation tasks complete (6.1-6.30), testing deferred until UI is ready (similar to PR #5)

- âœ… **PR #5 Complete**: Campaign creation & management (backend)
  - Created `/backend/schemas/campaign.py` with comprehensive campaign schemas:
    - `CampaignStatus` enum (draft, pending_approval, approved, rejected)
    - `CampaignCreate`, `CampaignResponse`, `CampaignUpdate`, `CampaignWithAssets`
    - `CampaignAssetResponse` for campaign-asset relationships
  - Created `/backend/routers/campaign.py` with full CRUD operations:
    - `POST /api/campaigns` - Create campaign with linked assets (status: draft)
    - `GET /api/campaigns` - Role-based filtering (advertisers see own, managers see pending)
    - `GET /api/campaigns/{campaign_id}` - Get campaign with assets (permission checks)
    - `PATCH /api/campaigns/{campaign_id}` - Update campaign details (only draft campaigns)
    - `DELETE /api/campaigns/{campaign_id}` - Delete campaign (only draft campaigns, cascades)
  - Created `/backend/crud/campaign.py` with database query functions:
    - `get_campaigns_by_user()` - Get all campaigns for a user
    - `get_campaigns_by_status()` - Get campaigns by status
    - `get_campaign_with_assets()` - Get campaign with eager-loaded assets
    - `link_assets_to_campaign()` - Link assets to campaign
  - Registered campaign router in `main.py`
  - Role-based access control: advertisers see own campaigns, managers see pending approval
  - Status validation: only draft campaigns can be updated/deleted
  - Asset validation: verifies all assets belong to user before linking
  - All implementation tasks complete (5.1-5.30), testing deferred until UI is ready

- âœ… **PR #4 Complete**: AI asset recategorization (backend)
  - Created `/backend/services/openai_service.py` with OpenAI client integration
  - Implemented `categorize_assets()` method using GPT-3.5-turbo with retry logic
  - Created `/backend/prompts/` module with structured prompts:
    - `asset_categorization.py`: Comprehensive categorization prompt with core principles, category definitions, guidelines
    - `email_generation.py`: Detailed email generation prompt with MJML best practices, design standards, content strategy
  - Added `POST /api/assets/recategorize` endpoint for AI-powered recategorization
  - Added `PATCH /api/assets/{asset_id}/category` endpoint for manual category updates
  - Updated `config.py` to support `.env.local` file (takes precedence over `.env`)
  - All endpoints tested and working
  - OpenAI service includes `generate_email_mjml()` method for PR #6 (email generation)

- âœ… **PR #3 Complete**: Asset upload & S3 integration (backend)
  - Created `/backend/services` directory with S3 and categorization services
  - Implemented S3 service (`s3_service.py`) with upload, pre-signed URL generation, and deletion
  - Implemented categorization service (`categorization_service.py`) with rules-based detection
  - Created asset schemas (`AssetCreate`, `AssetResponse`, `AssetUpdate`) with validators
  - Created asset router (`asset.py`) with full CRUD operations:
    - `POST /api/assets/upload` - Upload file to S3, categorize, store metadata
    - `GET /api/assets` - Get all user's assets
    - `GET /api/assets/{asset_id}` - Get specific asset
    - `DELETE /api/assets/{asset_id}` - Delete asset from S3 and database
  - Registered asset router in `main.py`
  - Created S3 bucket `email-assets-dev-goico` in us-east-2 region
  - All endpoints tested and working via Swagger UI
  - Updated config with AWS_REGION (us-east-2)

- âœ… **PR #2 Complete**: Authentication system (backend)
  - Created `/backend/routers` directory and `auth.py` router
  - Implemented `POST /api/auth/login` endpoint with email/password authentication
  - Created `/backend/dependencies.py` with `get_current_user` dependency function
  - Created `/backend/schemas` directory with user Pydantic models (UserResponse, LoginRequest, LoginResponse)
  - Registered auth router in `main.py`
  - Tested login endpoint with valid/invalid credentials
  - Updated README with authentication flow documentation
  - Added `email-validator` to requirements.txt

- âœ… **PR #1 Complete**: Project setup & database foundation
  - Project structure created (`/backend`, `/frontend`, `/scripts`, `/data`)
  - Backend setup: FastAPI app, virtual environment, dependencies installed
  - Database models: All 6 models created (User, Asset, Campaign, CampaignAsset, PerformanceMetric, SystemHealth)
  - Alembic migrations: Initial migration generated and applied
  - Seed data: JSON file and Python script created (ready to run)
  - CORS configured for Vite dev servers (ports 5173-5177)
  - Health endpoint created

## Next Steps

### Immediate
1. **Fix Railway migration commands**: Investigate why `railway run alembic upgrade head` and `railway run python ../scripts/seed_database.py` are not working
   - Railway root directory is set to `backend`
   - May need to use absolute paths or different command format
   - Alternative: Run migrations via Railway web terminal or add to startup script
2. **Run database migrations**: Once commands are fixed, run migrations on Railway
3. **Seed production database**: Run seed script to create initial users
4. **Test production deployment**: Verify all endpoints work with production database and S3 bucket

### Long-term
- Backend testing (PR #9)
- Security hardening
- Performance optimization
- Frontend testing suite

## Active Decisions

### Technical Decisions Made
1. **FastAPI over Flask**: Better async support, auto-docs, type safety
2. **SQLite for dev**: Zero config, fast iteration
3. **shadcn/ui over Material-UI**: More control, less bloat
4. **Axios over React Query**: Simpler for MVP, less abstraction
5. **Mock auth for MVP**: Speed over security (post-MVP hardening)

### Pending Decisions
1. **Deployment timeline**: Post-MVP, but need to plan

### Decisions for PR #16 (Role-Based Dashboard & Navigation)
1. **Dashboard Structure**: Keep current card-based structure, render role-specific dashboards (AdvertiserDashboard, ApprovalQueue, PerformanceDashboard) based on user role
2. **Advertiser Stats**: Calculate stats (total, approved, pending) from existing campaigns list (no new API endpoint)
3. **Navigation**: Keep header-only navigation, add role-based links in header
4. **Permission HOC**: RequireRole component redirects to role-appropriate main page if role not allowed (campaign_manager â†’ /approval-queue, tech_support â†’ /monitoring, others â†’ /dashboard)
5. **Dashboard Access**: Dashboard only accessible to advertisers; non-advertisers redirected to their main pages
6. **Navigation Links**: Removed "Create Campaign" from navigation (button still exists in AdvertiserDashboard), added "Upload Assets" to advertiser navigation

## Current Work Focus

**Primary Goal**: Frontend development
- PR #1 foundation complete âœ…
- Authentication backend (PR #2) - complete âœ…
- Asset upload system (PR #3) - complete âœ…
- AI recategorization (PR #4) - complete âœ…
- Campaign management (PR #5) - complete âœ…
- Email proof generation (PR #6) - complete âœ…
- Approval workflow (PR #7) - complete âœ…
- Performance monitoring (PR #8) - complete âœ…
- Backend testing (PR #9) - deferred
- Frontend setup & authentication (PR #10) - complete âœ…
- Asset upload UI (PR #11) - complete âœ…
- Campaign creation UI (PR #12) - complete âœ…
- Email preview & generation UI (PR #13) - complete âœ…
- Approval queue UI (PR #14) - complete âœ…
- Performance monitoring UI (PR #15) - complete âœ…
- Role-based dashboard & navigation (PR #16) - complete âœ…
- UI polish & final touches (PR #17) - complete âœ…
- **MVP COMPLETE** - All frontend features implemented

## Blockers & Risks

### Known Blockers
- **Railway migration commands not working**: `railway run alembic upgrade head` and `railway run python ../scripts/seed_database.py` are failing
  - Railway root directory is set to `backend`
  - Commands may need different path resolution or format
  - Need to investigate Railway CLI behavior with root directory configuration

### Potential Risks
1. **OpenAI API rate limits**: May need to implement queuing if high volume
2. **S3 configuration**: âœ… AWS credentials configured, bucket created (`email-assets-dev-goico`)
3. **MJML Node.js dependency**: Requires Node.js installed for Python package
4. **Timeline pressure**: 3-day MVP is aggressive, prioritize P0 features

## Key Files to Reference

- **PRD**: `/PRD.md` - Complete technical requirements
- **Tasks**: `/tasks-1.md`, `/tasks-2.md`, `/tasks-3.md` - Implementation checklist
- **Architecture**: `/architecture.mermaid` - System diagram

## Development Workflow

### Branch Strategy
- `main`: Production-ready code (protected)
- `develop`: Integration branch
- `feature/*`: Individual features
- `bugfix/*`: Bug fixes

### Commit Convention
```
feat: Add asset upload functionality
fix: Resolve S3 upload timeout issue
docs: Update API documentation
refactor: Simplify AI categorization logic
```

## Testing Strategy

### Backend (End of MVP)
- Pytest with async support
- Test critical paths: auth, upload, generation, approval
- Mock external services (S3, OpenAI)

### Frontend (Post-MVP)
- Not included in MVP scope
- Future: React Testing Library, Playwright E2E

## Performance Targets

- Email generation: <5 seconds
- Asset upload: <3 seconds
- API response: <500ms (p95)
- Frontend load: <2 seconds

## Notes

- MVP prioritizes functionality over deployment
- Security is intentionally minimal for speed (post-MVP hardening)
- Focus on P0 features only, P1/P2 are documented but not implemented
- Backend testing at end of MVP, frontend testing post-MVP

